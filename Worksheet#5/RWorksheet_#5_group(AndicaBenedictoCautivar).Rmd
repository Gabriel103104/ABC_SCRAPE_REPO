---
title: "RWorksheet#5"
author: "Andica, Benedicto, Cautivar"
date: "2024-11-06"
output: pdf_document
---
Extracting Amazon Product Reviews
4. Select 5 categories from Amazon and select 30 products from each category.
```{r}
library(polite)

url <- 'https://www.imdb.com/chart/toptv/?ref_=nv_tvv_250'

session <- bow(url,
               user_agent = "Educational")
session
```
```{r}
library(rvest)
library(httr)
library(dplyr)

title_list <- scrape(session) %>%
   html_nodes('h3.ipc-title__text') %>% 
  html_text
  
title_list_sub <- as.data.frame(title_list[2:26])

colnames(title_list_sub) <- "Ranks"
split_df <- strsplit(as.character(title_list_sub$Ranks),".",fixed = TRUE)
split_df <- data.frame(do.call(rbind,split_df))

colnames(split_df) <- c("Ranks","Title") 

titleAndRank <- data.frame(split_df)


ratings <- scrape(session) %>%
   html_nodes('span.ipc-rating-star--rating') %>% 
  html_text

ratingsDf <- data.frame(ratings)

numberOfPeopleVoted <- scrape(session) %>%
   html_nodes('span.ipc-rating-star--voteCount') %>% 
  html_text

cleanedVotes <- gsub('[()]', '', numberOfPeopleVoted)

cleanedVotesDf <- data.frame(cleanedVotes)

numEpisodes <- scrape(session) %>%
   html_nodes('span.sc-5bc66c50-6.OOdsw.cli-title-metadata-item:nth-of-type(2)') %>% 
  html_text

numEpisodesDf <- data.frame(numEpisodes)

Year <- scrape(session) %>%
   html_nodes('span.sc-5bc66c50-6.OOdsw.cli-title-metadata-item:nth-of-type(1)') %>% 
  html_text

YearDf <- data.frame(Year)

topShows <- cbind(titleAndRank, ratingsDf, cleanedVotesDf, numEpisodesDf, YearDf)
  
topShows 
```

```{r}
homePage <- 'https://www.imdb.com/chart/toptv/'
mainPage <- read_html(homePage)

links <- mainPage %>%
  html_nodes("a.ipc-title-link-wrapper") %>%
  html_attr("href")

showInfo <- lapply(links, function(link) {
  fullLink <- paste0("https://imdb.com", link)

  userRevLink <- read_html(fullLink)
  userRevPageLink <-  userRevLink  %>%
    html_nodes('a.isReview') %>%
    html_attr("href")
  
  criticRev <- userRevLink %>%
              html_nodes("span.score") %>%
              html_text()
  criticDf <- data.frame(Critic_Reviews = criticRev[2], stringsAsFactors = FALSE)
  
  popularityRating <-  userRevLink %>%
              html_nodes('[data-testid="hero-rating-bar__popularity__score"]') %>%
              html_text()
  
  userRev <- read_html(paste0("https://imdb.com",  userRevPageLink[1]))
  userRevCount <- userRev %>%
    html_nodes('[data-testid="tturv-total-reviews"]') %>%
    html_text()

  return(data.frame(User_Reviews = userRevCount, Critic = criticDf, Popularity_Rating = popularityRating)) 
})



showUrlDf <- do.call(rbind, showInfo)
showUrlDf

allShows <- cbind(topShows, showUrlDf)
allShows 
```




g